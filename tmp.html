<!DOCTYPE html>
<html lang="en">
<head id="head"></head>
<body>

    <div id="wrapper">

        <section class="section single-wrapper">
            <div class="container">
                <div class="row">
                    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12">
                        <div class="page-wrapper">
<!--                            <div class="blog-title-area text-center">-->

<!--                                <span class="color-orange"><a href="" title="">Food</a></span>-->

<!--                                <h3 class="read-article-title">Growing Enough Food to Feed a Family Year-Round by Yourself</h3>-->

<!--                                <div class="blog-meta big-meta">-->
<!--                                    <small><a href="" title="">21 July, 2017</a></small>-->
<!--                                    <small><a href="" title="">by Karthik</a></small>-->
<!--                                </div>&lt;!&ndash; end meta &ndash;&gt;-->

<!--                            </div>&lt;!&ndash; end title &ndash;&gt;-->

<!--                            <div class="single-post-media">-->
<!--                                <img loading="lazy" alt="Peoples Blog" src="/upload/banner800x460/public/Peoples-Blog-Growing-Enough-Food-to-Feed-a-Family.jpg" class="img-fluid">-->
<!--                            </div>&lt;!&ndash; end media &ndash;&gt;-->

                            <div class="blog-content read-article-content">
<!--                                <p>and how to <strong>preserve your extra harvest.</strong></p>-->
<!--                                <h3>How much food is needed?</h3>-->
<!--                                <div class="ads-page-3"></div>-->
<!--                                <ul class="check">-->
<!--                                    <li>Do Intercropping</li>-->
<!--                                </ul>-->
<p>Drupal's batch API processing is very nice and provides few benifits, We can break long tasks into smaller batches, and by this we will be able to prevent maximum execution time errors.</p>
<p>This article will show how to Build a batch routine in a custom module, its more straight forward approach, you can follow up below code, which is been explained with required comments.</p>
<p>Create your custom module, which contains <code>custom.info</code> and <code>custom.module</code> files</p>
<p>The below code put in your <code>custom.module</code> file</p>
<pre>function custom_menu() {<br/>
&nbsp;$items['admin/custom_batch'] = array(<br/>
&nbsp; &nbsp;'title' =&gt; 'Custom Batch',<br/>
&nbsp; &nbsp;'description' =&gt; 'Custom Batch Process',<br/>
&nbsp; &nbsp;'type' =&gt; MENU_NORMAL_ITEM,<br/>
&nbsp; &nbsp;'access callback' =&gt; TRUE,<br/>
&nbsp; &nbsp;'page callback' =&gt; 'drupal_get_form',<br/>
&nbsp; &nbsp;'page arguments' =&gt; array('custom_batch_form'),<br/>
&nbsp;);<br/>
&nbsp;return $items;<br/>}</pre>
<pre>function custom_batch_form($form, $form_state) {<br/>
&nbsp;$form["text"]['#markup'] = "Custom batch process to update nodes.... ";<br/>
&nbsp;$form['submit'] = array(<br/>
&nbsp; &nbsp;'#type' =&gt; 'submit',<br/>
&nbsp; &nbsp;'#value' =&gt; t('Run Batch'),<br/>
&nbsp;);<br/>
&nbsp;return $form;<br/>}</pre>
<pre>function custom_batch_form_submit($form, $form_state) {<br/>
&nbsp;batch_set(custom_batch_update_nodes());<br/>}</pre>
<pre>function custom_batch_update_nodes() {<br/>
&nbsp;drupal_set_message('Updating Nodes');<br/>
&nbsp;$nodes = node_load_multiple(array(), array('type' =&gt; "story_song"));<br/>
&nbsp;$node_count = count($nodes);<br/>
&nbsp;foreach($nodes as $nid=&gt;$node) {<br/>
&nbsp; &nbsp;$operations[] = array('custom_batch_each_operation', array($node));<br/>
&nbsp;}<br/>
&nbsp;$batch = array(<br/>
&nbsp; &nbsp;'operations' =&gt; $operations,<br/>
&nbsp; &nbsp;'finished' =&gt; 'custom_batch_update_nodes_finished',<br/>
&nbsp;);<br/>
&nbsp;return $batch;<br/>}</pre>
<pre>function custom_batch_each_operation($node, &amp;$context) {<br/>
&nbsp;$context['results'][] = $node-&gt;nid . ' : ' . check_plain($node-&gt;title);<br/>
&nbsp;$context['message'] = t('Processing node "@title"', array('@title' =&gt; $node-&gt;title));<br/>
&nbsp;$updated = FALSE;<br/>
&nbsp;if ($updated) {<br/>
&nbsp; &nbsp;node_save($node);<br/>
&nbsp; &nbsp;$path = drupal_lookup_path("alias", "node/" . $node-&gt;nid);<br/>
&nbsp; &nbsp;drupal_set_message("&lt;a href='/$path'&gt;" . $node-&gt;title . "&lt;/a&gt; updated.");<br/>
&nbsp;}<br/>}</pre>
<pre>function custom_batch_update_nodes_finished($success, $results, $operations) {<br/>
&nbsp;if ($success) {<br/>
&nbsp; &nbsp;drupal_set_message(t('@count nodes processed.', array('@count' =&gt; count($results))));<br/>
&nbsp;}<br/>
&nbsp;else {<br/>
&nbsp; &nbsp;$error_operation = reset($operations);<br/>
&nbsp; &nbsp;drupal_set_message(t('An error occurred while processing @operation with arguments : @args', array('@operation' =&gt; $error_operation[0], '@args' =&gt; print_r($error_operation[0], TRUE))));<br/>
&nbsp;}<br/>}</pre>
<p>Thank you. </p>

                            </div><!-- end content -->

                        </div><!-- end page-wrapper -->
                    </div><!-- end col -->


                </div><!-- end row -->
            </div><!-- end container -->
        </section>

    </div><!-- end wrapper -->

    <!-- Core JavaScript
    ================================================== -->
    <script src="js/jquery.min.js"></script>
    <script src="js/tether.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/custom.js"></script>

</body>
</html>
