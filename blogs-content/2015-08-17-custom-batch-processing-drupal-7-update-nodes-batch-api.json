{
  "content": {
    "title": "Custom Batch processing in Drupal 7 to update Nodes - Batch API",
    "created": "17 Aug, 2015",
    "author": "Karthik Kumar D K",
    "views": "463",
    "summary": "Drupal's batch API processing is very nice and provides few benifits, We can break long tasks into smaller batches, and by this we will be able to prevent maximum execution time errors.",
    "content": "<p>Drupal's batch API processing is very nice and provides few benifits, We can break long tasks into smaller batches, and by this we will be able to prevent maximum execution time errors.</p>\n<p>This article will show how to Build a batch routine in a custom module, its more straight forward approach, you can follow up below code, which is been explained with required comments.</p>\n<p>Create your custom module, which contains <code>custom.info</code> and <code>custom.module</code> files</p>\n<p>The below code put in your <code>custom.module</code> file</p>\n<pre>function custom_menu() {<br/>\n&nbsp;$items['admin/custom_batch'] = array(<br/>\n&nbsp; &nbsp;'title' =&gt; 'Custom Batch',<br/>\n&nbsp; &nbsp;'description' =&gt; 'Custom Batch Process',<br/>\n&nbsp; &nbsp;'type' =&gt; MENU_NORMAL_ITEM,<br/>\n&nbsp; &nbsp;'access callback' =&gt; TRUE,<br/>\n&nbsp; &nbsp;'page callback' =&gt; 'drupal_get_form',<br/>\n&nbsp; &nbsp;'page arguments' =&gt; array('custom_batch_form'),<br/>\n&nbsp;);<br/>\n&nbsp;return $items;<br/>}</pre>\n<pre>function custom_batch_form($form, $form_state) {<br/>\n&nbsp;$form[\"text\"]['#markup'] = \"Custom batch process to update nodes.... \";<br/>\n&nbsp;$form['submit'] = array(<br/>\n&nbsp; &nbsp;'#type' =&gt; 'submit',<br/>\n&nbsp; &nbsp;'#value' =&gt; t('Run Batch'),<br/>\n&nbsp;);<br/>\n&nbsp;return $form;<br/>}</pre>\n<pre>function custom_batch_form_submit($form, $form_state) {<br/>\n&nbsp;batch_set(custom_batch_update_nodes());<br/>}</pre>\n<pre>function custom_batch_update_nodes() {<br/>\n&nbsp;drupal_set_message('Updating Nodes');<br/>\n&nbsp;$nodes = node_load_multiple(array(), array('type' =&gt; \"story_song\"));<br/>\n&nbsp;$node_count = count($nodes);<br/>\n&nbsp;foreach($nodes as $nid=&gt;$node) {<br/>\n&nbsp; &nbsp;$operations[] = array('custom_batch_each_operation', array($node));<br/>\n&nbsp;}<br/>\n&nbsp;$batch = array(<br/>\n&nbsp; &nbsp;'operations' =&gt; $operations,<br/>\n&nbsp; &nbsp;'finished' =&gt; 'custom_batch_update_nodes_finished',<br/>\n&nbsp;);<br/>\n&nbsp;return $batch;<br/>}</pre>\n<pre>function custom_batch_each_operation($node, &amp;$context) {<br/>\n&nbsp;$context['results'][] = $node-&gt;nid . ' : ' . check_plain($node-&gt;title);<br/>\n&nbsp;$context['message'] = t('Processing node \"@title\"', array('@title' =&gt; $node-&gt;title));<br/>\n&nbsp;$updated = FALSE;<br/>\n&nbsp;if ($updated) {<br/>\n&nbsp; &nbsp;node_save($node);<br/>\n&nbsp; &nbsp;$path = drupal_lookup_path(\"alias\", \"node/\" . $node-&gt;nid);<br/>\n&nbsp; &nbsp;drupal_set_message(\"&lt;a href='/$path'&gt;\" . $node-&gt;title . \"&lt;/a&gt; updated.\");<br/>\n&nbsp;}<br/>}</pre>\n<pre>function custom_batch_update_nodes_finished($success, $results, $operations) {<br/>\n&nbsp;if ($success) {<br/>\n&nbsp; &nbsp;drupal_set_message(t('@count nodes processed.', array('@count' =&gt; count($results))));<br/>\n&nbsp;}<br/>\n&nbsp;else {<br/>\n&nbsp; &nbsp;$error_operation = reset($operations);<br/>\n&nbsp; &nbsp;drupal_set_message(t('An error occurred while processing @operation with arguments : @args', array('@operation' =&gt; $error_operation[0], '@args' =&gt; print_r($error_operation[0], TRUE))));<br/>\n&nbsp;}<br/>}</pre>\n<p>Thank you. </p>",
    "type": "Sci-Tech",
    "category": "Drupal",
    "banner394x449": "upload/banner394x449/public/D7install5_0.png",
    "banner600x500": "upload/banner600x500/public/D7install5_0.png",
    "banner788x443": "upload/banner788x443/public/D7install5_0.png",
    "banner800x460": "upload/banner800x460/public/D7install5_0.png",
    "file": "2015-08-17-custom-batch-processing-drupal-7-update-nodes-batch-api.json"
  }
}