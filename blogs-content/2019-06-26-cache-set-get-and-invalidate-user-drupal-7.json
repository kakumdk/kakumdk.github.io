{
  "content": {
    "title": "Cache Set, Get and Invalidate per User in Drupal 7",
    "created": "26 Jun, 2019",
    "author": "Karthik Kumar D K",
    "views": "463",
    "summary": "How to Set, Get and Invalidate the caches per user in Drupal 7, this blog article will explain a brief of how to do such implementation on Drupal using the default drupal cache functions",
    "content": "<p>How to Set, Get and Invalidate the caches per user in Drupal 7, this blog article will explain a brief of how to do such implementation on Drupal using the default drupal cache functions.</p>\n                                <p>Here, we go with the steps</p>\n                                <ul>\n                                    <li>Initially, create the custom functions for Get, Set and Invalidate the caches per user.</li>\n                                    <li>Here, cache id per user is pretty important, where user id or user email id will used as part of cache id.</li>\n                                    <li>And these functions should be used as when required for caching the page.</li>\n                                    <li>Their will be cases like, Caches should be Invalidated on some actions for that particular user. These can be covered with these below functions.</li>\n                                </ul>\n                                <div class=\"ads-page-3\"></div>\n                                <p>Here's the functions which are used to Get, Set and Invalidate caches.</p>\n                                <pre style=\"background-color:#ffffff;color:#000000;font-family:'DejaVu Sans Mono';font-size:9.0pt;\"><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">&lt;?php\n</span>\n<span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">function </span><span style=\"background-color:#f7faff;\">_get_cache(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache_id</span><span style=\"background-color:#f7faff;\">) {\n</span><span style=\"background-color:#f7faff;\">    </span><span style=\"color:#660000;background-color:#f7faff;\">$cache </span><span style=\"background-color:#f7faff;\">= cache_get(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache_id</span><span style=\"background-color:#f7faff;\">);\n</span><span style=\"background-color:#f7faff;\">    </span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">if </span><span style=\"background-color:#f7faff;\">(</span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">isset</span><span style=\"background-color:#f7faff;\">(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache_id</span><span style=\"background-color:#f7faff;\">) &amp;&amp; </span><span style=\"color:#660e7a;background-color:#f7faff;font-weight:bold;font-style:italic;\">REQUEST_TIME </span><span style=\"background-color:#f7faff;\">&lt; </span><span style=\"color:#660000;background-color:#f7faff;\">$cache</span><span style=\"background-color:#f7faff;\">-&gt;</span><span style=\"color:#660e7a;background-color:#f7faff;font-weight:bold;\">expire</span><span style=\"background-color:#f7faff;\">) {\n</span><span style=\"background-color:#f7faff;\">        </span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">return </span><span style=\"color:#660000;background-color:#f7faff;\">$cache</span><span style=\"background-color:#f7faff;\">-&gt;</span><span style=\"color:#660e7a;background-color:#f7faff;font-weight:bold;\">data</span><span style=\"background-color:#f7faff;\">;\n</span><span style=\"background-color:#f7faff;\">    }\n</span><span style=\"background-color:#f7faff;\">    </span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">else </span><span style=\"background-color:#f7faff;\">{\n</span><span style=\"background-color:#f7faff;\">        </span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">return NULL</span><span style=\"background-color:#f7faff;\">;\n</span><span style=\"background-color:#f7faff;\">    }\n</span><span style=\"background-color:#f7faff;\">}\n</span>\n<span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">function </span><span style=\"background-color:#f7faff;\">_set_cache(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache_id</span><span style=\"background-color:#f7faff;\">, </span><span style=\"color:#660000;background-color:#f7faff;\">$data</span><span style=\"background-color:#f7faff;\">) {\n</span><span style=\"background-color:#f7faff;\">    cache_set(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache_id</span><span style=\"background-color:#f7faff;\">, </span><span style=\"color:#660000;background-color:#f7faff;\">$data</span><span style=\"background-color:#f7faff;\">, </span><span style=\"color:#008000;background-color:#f7faff;font-weight:bold;\">'cache'</span><span style=\"background-color:#f7faff;\">, </span><span style=\"color:#660e7a;background-color:#f7faff;font-weight:bold;font-style:italic;\">REQUEST_TIME </span><span style=\"background-color:#f7faff;\">+ (</span><span style=\"color:#0000ff;background-color:#f7faff;\">60 </span><span style=\"background-color:#f7faff;\">* </span><span style=\"color:#0000ff;background-color:#f7faff;\">60</span><span style=\"background-color:#f7faff;\">));\n</span><span style=\"background-color:#f7faff;\">}\n</span>\n<span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">function </span><span style=\"background-color:#f7faff;\">_invalidate_cache(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache_id</span><span style=\"background-color:#f7faff;\">) {\n</span><span style=\"background-color:#f7faff;\">    </span><span style=\"color:#660000;background-color:#f7faff;\">$cache </span><span style=\"background-color:#f7faff;\">= cache_get(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache_id</span><span style=\"background-color:#f7faff;\">);\n</span><span style=\"background-color:#f7faff;\">    </span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">if </span><span style=\"background-color:#f7faff;\">(</span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">isset</span><span style=\"background-color:#f7faff;\">(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache</span><span style=\"background-color:#f7faff;\">) &amp;&amp; !</span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">empty</span><span style=\"background-color:#f7faff;\">(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache</span><span style=\"background-color:#f7faff;\">)) {\n</span><span style=\"background-color:#f7faff;\">        cache_clear_all(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache</span><span style=\"background-color:#f7faff;\">-&gt;</span><span style=\"color:#660e7a;background-color:#f7faff;font-weight:bold;\">cid</span><span style=\"background-color:#f7faff;\">, </span><span style=\"color:#008000;background-color:#f7faff;font-weight:bold;\">'cache'</span><span style=\"background-color:#f7faff;\">);\n</span><span style=\"background-color:#f7faff;\">    }\n</span><span style=\"background-color:#f7faff;\">}\n</span></pre><p><span style=\"background-color:#f7faff;\">Here's the function where we Set the cache on page load, if at all already cache doesn't exist for this cache id.</span></p>\n                                <pre style=\"background-color:#ffffff;color:#000000;font-family:'DejaVu Sans Mono';font-size:9.0pt;\"><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">function </span><span style=\"background-color:#f7faff;\">sample() {\n</span><span style=\"background-color:#f7faff;\">    </span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">global </span><span style=\"color:#660000;background-color:#f7faff;\">$user</span><span style=\"background-color:#f7faff;\">;\n</span><span style=\"background-color:#f7faff;\">    </span><span style=\"color:#660000;background-color:#f7faff;\">$cache_id </span><span style=\"background-color:#f7faff;\">= </span><span style=\"color:#660000;background-color:#f7faff;\">$user</span><span style=\"background-color:#f7faff;\">-&gt;</span><span style=\"color:#660e7a;background-color:#f7faff;font-weight:bold;\">uid </span><span style=\"background-color:#f7faff;\">. </span><span style=\"color:#008000;background-color:#f7faff;font-weight:bold;\">\"_sample\"</span><span style=\"background-color:#f7faff;\">;\n</span><span style=\"background-color:#f7faff;\">    </span><span style=\"color:#660000;background-color:#f7faff;\">$cache_data </span><span style=\"background-color:#f7faff;\">= _get_cache(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache_id</span><span style=\"background-color:#f7faff;\">);\n</span><span style=\"background-color:#f7faff;\">    </span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">if </span><span style=\"background-color:#f7faff;\">(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache_data </span><span style=\"background-color:#f7faff;\">== </span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">NULL</span><span style=\"background-color:#f7faff;\">) {\n</span><span style=\"background-color:#f7faff;\">        </span><span style=\"color:#660000;background-color:#f7faff;\">$cache_data </span><span style=\"background-color:#f7faff;\">= </span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">array</span><span style=\"background-color:#f7faff;\">();\n</span><span style=\"background-color:#f7faff;\">        </span><span style=\"color:#808080;background-color:#f7faff;font-style:italic;\">// Here processed data should be cached\n</span><span style=\"color:#808080;background-color:#f7faff;font-style:italic;\">        </span><span style=\"color:#660000;background-color:#f7faff;\">$data </span><span style=\"background-color:#f7faff;\">= getData();\n</span><span style=\"background-color:#f7faff;\">        </span><span style=\"color:#660000;background-color:#f7faff;\">$cache_data</span><span style=\"background-color:#f7faff;\">[</span><span style=\"color:#008000;background-color:#f7faff;font-weight:bold;\">'data'</span><span style=\"background-color:#f7faff;\">] = </span><span style=\"color:#660000;background-color:#f7faff;\">$data</span><span style=\"background-color:#f7faff;\">;\n</span><span style=\"background-color:#f7faff;\">        _set_cache(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache_id</span><span style=\"background-color:#f7faff;\">, </span><span style=\"color:#660000;background-color:#f7faff;\">$cache_data</span><span style=\"background-color:#f7faff;\">);\n</span><span style=\"background-color:#f7faff;\">    }\n</span><span style=\"background-color:#f7faff;\">    </span><span style=\"color:#000080;background-color:#f7faff;font-weight:bold;\">return </span><span style=\"color:#660000;background-color:#f7faff;\">$cache_data</span><span style=\"background-color:#f7faff;\">;\n</span><span style=\"background-color:#f7faff;\">}</span></pre><p><span style=\"background-color:#f7faff;\">Here's the function used to Invalidate the caches, on some particular actions of the particular user.</span></p>\n                                <pre style=\"background-color:#ffffff;color:#000000;font-family:'DejaVu Sans Mono';font-size:9.0pt;\"><span style=\"color:#660000;background-color:#f7faff;\">$cache_id </span><span style=\"background-color:#f7faff;\">= </span><span style=\"color:#660000;background-color:#f7faff;\">$user</span><span style=\"background-color:#f7faff;\">-&gt;</span><span style=\"color:#660e7a;background-color:#f7faff;font-weight:bold;\">id </span><span style=\"background-color:#f7faff;\">. </span><span style=\"color:#008000;background-color:#f7faff;font-weight:bold;\">\"_sample\"</span><span style=\"background-color:#f7faff;\">;\n</span><span style=\"background-color:#f7faff;\">_invalidate_cache(</span><span style=\"color:#660000;background-color:#f7faff;\">$cache_id</span><span style=\"background-color:#f7faff;\">);\n</span></pre><p>Advantages of having the caches enabled for few pages, The page load time will be reduced..</p>\n                                <p>Cheers :)</p>",
    "type": "Sci-Tech",
    "category": "Drupal",
    "banner394x449": "upload/banner394x449/public/cache_segments_and_caching_in_drupal_7.jpg",
    "banner600x500": "upload/banner600x500/public/cache_segments_and_caching_in_drupal_7.jpg",
    "banner788x443": "upload/banner788x443/public/cache_segments_and_caching_in_drupal_7.jpg",
    "banner800x460": "upload/banner800x460/public/cache_segments_and_caching_in_drupal_7.jpg",
    "file": "2019-06-26-cache-set-get-and-invalidate-user-drupal-7.json"
  }
}